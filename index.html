<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Dawat — Catering Quote (Final)</title>
<style>
  :root{
  --accent: #071a3b;       /* deep dark blue */
  --gold:   #d4af37;       /* golden/yellowish */
  --bg:     #000000;       /* page background (black) */
  --card:   #0b0b0b;       /* dark card fallback */
  --muted:  #cfc8b0;       /* muted/goldish text for secondary info */
  --radius: 12px;
  font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
}
  body{
  margin:0;
  background:var(--bg);
  color:#fff;
  min-height:100vh;
  display:flex;
  align-items:flex-start;
  justify-content:center;
  padding:28px;
}
  .app{width:100%;max-width:1200px}
  .topbar{display:flex;align-items:center;gap:16px;margin-bottom:16px}
  .brand h1{ margin:0; font-size:20px; color:var(--gold); }
  .layout{display:grid;grid-template-columns:1fr 420px;gap:18px}
  .card{
  background: linear-gradient(180deg, rgba(11,11,11,0.98), rgba(7,26,59,0.96));
  border-radius:var(--radius);
  box-shadow: 0 10px 30px rgba(0,0,0,0.75);
  padding:18px;
  color:#fff;
  border: 1px solid rgba(212,175,55,0.08);
}
  .wizard-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}
  .stepText{color:var(--muted);font-size:13px}
  .prog{height:8px;background:#e9f1ff;border-radius:999px;overflow:hidden;margin-top:10px}
  .prog > i{ display:block; height:100%; background:linear-gradient(90deg,var(--gold),var(--accent)); width:0% }
  .step{display:none}
  .step.active{display:block}
  label{ display:block; margin-bottom:8px; color:#fff; }
 input[type="number"], select, .radio-row, input[type="text"], input[type="email"], input[type="tel"], textarea, input[type="date"]{
  width:100%;
  padding:10px;
  border-radius:10px;
  border:1px solid rgba(255,255,255,0.06);
  background: rgba(255,255,255,0.02);
  color:#fff;
  font-size:15px;
}
input::placeholder, textarea::placeholder { color: rgba(255,255,255,0.45); }
  textarea{min-height:80px;resize:vertical}
  .radio-row{display:flex;gap:12px;flex-wrap:wrap}
  .row{display:flex;gap:12px;align-items:center}
  .small{color:var(--muted)}
  .controls{display:flex;justify-content:space-between;gap:8px;margin-top:14px}
  .btn{
  background:var(--gold);
  color:#000;
  padding:10px 14px;
  border-radius:10px;
  border:none;
  font-weight:800;
  cursor:pointer;
  box-shadow: 0 6px 18px rgba(212,175,55,0.12);
}
.btn.ghost{
  background:transparent;
  color:var(--gold);
  border:1px solid rgba(212,175,55,0.18);
}
  .summary h3{margin-top:0}
  .summary .line{ display:flex; justify-content:space-between; padding:6px 0; border-bottom:1px dashed rgba(255,255,255,0.04); }
  .muted{color:var(--muted)}
.menu-modal{ position:fixed; inset:0; background:rgba(0,0,0,0.75); display:none; align-items:flex-start; justify-content:center; padding:40px; z-index:60; }
.menu-panel{
  background: linear-gradient(180deg, rgba(7,26,59,0.98), rgba(11,11,11,0.98));
  width:100%;
  max-width:1100px;
  border-radius:14px;
  padding:18px;
  max-height:86vh;
  overflow:auto;
  color:#fff;
  border:1px solid rgba(212,175,55,0.06);
}
  .menu-header{display:flex;align-items:center;justify-content:space-between;gap:12px;margin-bottom:12px}
  .menu-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:12px}
  .menu-card{
  border-radius:10px;
  padding:12px;
  border:1px solid rgba(212,175,55,0.06);
  background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
  cursor:pointer;
  position:relative;
  min-height:88px;
  color:#fff;
}
.menu-card h4{ color:#fff; }
.menu-card p{ color:var(--muted); }
  .menu-card .price{ position:absolute; top:10px; right:10px; background:var(--gold); color:#000; padding:6px 8px; border-radius:8px; font-weight:700; font-size:13px; }
  .menu-card.selected{ outline:3px solid rgba(212,175,55,0.10); box-shadow:0 8px 30px rgba(11,26,59,0.45); transform:translateY(-3px); }
  .menu-card .selBadge{position:absolute;left:10px;bottom:10px;background:var(--accent);color:#fff;padding:6px 8px;border-radius:8px;font-size:12px}
  .menu-actions{display:flex;justify-content:space-between;gap:12px;margin-top:12px}
  .menu-panel button { color: var(--gold); border-color: rgba(212,175,55,0.08); }
.active{box-shadow:0 6px 18px rgba(11,79,168,0.08);border-color:rgba(11,79,168,0.12)}
  /* package card styles */
  .packages-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:12px;margin-top:12px}
  .package-card{
  padding:12px;
  border-radius:12px;
  border:1px solid rgba(212,175,55,0.08);
  background: linear-gradient(180deg, rgba(212,175,55,0.03), rgba(7,26,59,0.14));
  cursor:pointer;
  position:relative;
  min-height:110px;
  color:#fff;
}
  .package-card h4{margin:0;font-size:16px}
  .package-card .meta{ margin-top:8px; color:var(--muted); font-size:13px; }
.package-card .perhead{ position:absolute; top:12px; right:12px; background:var(--gold); color:#000; padding:6px 8px; border-radius:8px; font-weight:700; }
  .package-card.selected{outline:3px solid rgba(11,79,168,0.12);box-shadow:0 10px 30px rgba(11,79,168,0.06)}
  /* pdf preview */
  #pdfPreview{border:1px solid #eef2f8;padding:12px;border-radius:10px;background:#fff;min-height:400px;overflow:auto}
  @media(max-width:980px){ .layout{grid-template-columns:1fr} .menu-modal{padding:18px} }
/* Make menu "Apply & Close" buttons use black text for legibility */
#applySelections,
#closeMenu {
  color: #000 !important;            /* black text */
  text-shadow: none !important;      /* remove any light text-shadow that may lighten text */
}

/* Ensure primary Apply button remains golden background with black text */
#applySelections.btn {
  background: var(--gold) !important;
  border-color: rgba(0,0,0,0.06) !important;
  box-shadow: 0 6px 18px rgba(0,0,0,0.08) !important;
}

/* If Close is a ghost button keep it visually subtle but with black text */
#closeMenu.btn.ghost {
  background: transparent !important;
  border-color: rgba(212,175,55,0.12) !important;
  color: #000 !important;
}
</style>
<!-- jsPDF & html2canvas -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
</head>
<body>
<div class="app">
  <div class="topbar">
    <div class="brand">
      <h1>Dawat:The Art of Cooking — Catering Quote</h1>
      <p class="small">Normalized menu & instant quoting — choose package then pick dishes</p>
    </div>
  </div>

  <div class="layout">
    <!-- LEFT: Wizard -->
    <div class="card">
      <div class="wizard-header">
        <div>
          <div style="font-weight:800;font-size:18px">Quick Catering</div>
          <div id="stepText" class="small muted">Step 1 of 8</div>
          <div class="prog"><i id="progBar"></i></div>
        </div>
        <div class="small muted">Prices editable in script</div>
      </div>

      <div id="steps">
        <!-- Step 1: Customer info -->
        <div class="step active" id="step-customer">
          <fieldset style="border:0;padding:0;margin:0">
            <legend style="font-weight:700;margin-bottom:6px">1) Customer details</legend>
            <div style="display:grid;gap:8px">
              <div><label for="custName">Customer name</label><input type="text" id="custName" placeholder="Customer name"></div>
              <div><label for="custEmail">Email</label><input type="email" id="custEmail" placeholder="Email"></div>
              <div><label for="custPhone">Phone</label><input type="tel" id="custPhone" placeholder="Phone"></div>
              <div><label for="custDate">Event date</label><input type="date" id="custDate" placeholder="Event date"></div>
              <div><label for="custAddress">Event address / venue</label><textarea id="custAddress" placeholder="Event address / venue"></textarea></div>
            </div>
          </fieldset>
          <div class="small muted" style="margin-top:8px">We'll include these details in the PDF export.</div>
        </div>

        <!-- Step 2: Guests -->
        <div class="step" id="step-guests">
          <label for="guests">2) How many guests?</label>
          <input type="number" id="guests" min="1" value="120">
          <div class="small muted" style="margin-top:6px">Enter expected guests. Some packages have minimum guest counts (noted below).</div>
        </div>

        <!-- Step 3: Service -->
        <div class="step" id="step-service">
          <div><label id="label-service">3) Service Type</label></div>
          <div class="radio-row" role="radiogroup" aria-labelledby="label-service">
            <label><input type="radio" name="service" value="table" checked> Table (Plated)</label>
            <label><input type="radio" name="service" value="buffet"> Buffet</label>
          </div>
        </div>

        <!-- Step 4: Package cards -->
        <div class="step" id="step-packages">
          <label for="packageSelect">4) Choose a Package</label>
          <select id="packageSelect" style="display:none"></select>
          <div class="packages-grid" id="packagesGrid"></div>
          <div style="margin-top:12px">
            <label><input type="checkbox" id="lockPackage" checked> Use package as-is (no customisation)</label>
            <div class="small muted">Uncheck to customise package (changes cost £2/head per add/remove). Default: checked.</div>
          </div>
        </div>

        <!-- Step 5: Per-guest counts -->
        <div class="step" id="step-counts">
          <label>5) Set per-guest counts</label>
          <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(140px,1fr));gap:10px">
            <div><label for="nCanapes">Canapés per guest (0–4)</label><input type="number" id="nCanapes" min="0" max="4" value="2"></div>
            <div><label for="nStarters">Starters per guest (0–4)</label><input type="number" id="nStarters" min="0" max="5" value="1"></div>
            <div><label for="nMains">Mains per guest (0–7)</label><input type="number" id="nMains" min="0" max="10" value="2"></div>
            <div><label for="nDesserts">Desserts per guest (0–3)</label><input type="number" id="nDesserts" min="0" max="4" value="1"></div>
          </div>
        </div>

        <!-- Step 6: Menu selection -->
        <div class="step" id="step-menu">
          <div><label id="label-menu">6) Choose Dishes from Menu</label></div>
          <div style="margin-bottom:10px">
            <button aria-labelledby="label-menu" type="button" class="btn" id="openMenuBtnInline">Open Full Menu</button>
            <div class="small muted" style="margin-top:8px">Pick unique items per category up to the counts set earlier. Special items add £2/head. Each juice/mocktail adds £1/head. One bread is free; second bread adds an extra per head charge.</div>
          </div>
        </div>

        <!-- Step 7: Add-ons & discount -->
        <div class="step" id="step-addons">
          <label>7) Extra add-ons (total, not per head) & discount</label>
          <div style="display:grid;gap:8px">
            <div style="display:flex;gap:8px">
              <div style="flex:1"><label for="addonLabel1">Add-on 1 label</label><input placeholder="Add-on 1 (e.g., Live station)" id="addonLabel1" style="width:100%"></div>
              <div style="width:140px"><label for="addonVal1">Add-on 1 £</label><input type="number" id="addonVal1" placeholder="£0.00" min="0" style="width:100%"></div>
            </div>
            <div style="display:flex;gap:8px">
              <div style="flex:1"><label for="addonLabel2">Add-on 2 label</label><input placeholder="Add-on 2" id="addonLabel2" style="width:100%"></div>
              <div style="width:140px"><label for="addonVal2">Add-on 2 £</label><input type="number" id="addonVal2" placeholder="£0.00" min="0" style="width:100%"></div>
            </div>
            <div style="display:flex;gap:8px">
              <div style="flex:1"><label for="addonLabel3">Add-on 3 label</label><input placeholder="Add-on 3" id="addonLabel3" style="width:100%"></div>
              <div style="width:140px"><label for="addonVal3">Add-on 3 £</label><input type="number" id="addonVal3" placeholder="£0.00" min="0" style="width:100%"></div>
            </div>
            <div style="display:flex;gap:8px;align-items:center;margin-top:6px">
              <label for="discountPct" style="min-width:140px">Discount (%)</label>
              <input type="number" id="discountPct" min="0" max="50" value="0" style="width:120px;padding:10px;border-radius:8px;border:1px solid #e8eef6">
              <div class="small muted" style="margin-left:8px">0 or 5–50% (0 = none).</div>
            </div>
          </div>
        </div>

        <!-- Step 8: PDF Preview & Download -->
        <div class="step" id="step-pdf">
          <label id="label-pdf">8) Preview & Download PDF</label>
          <div class="small muted" style="margin-bottom:8px">This preview shows exactly what will be exported to the A4 PDF. Click "Download PDF" to generate and download.</div>
          <div id="pdfPreview" aria-labelledby="label-pdf" aria-live="polite"></div>
          <div style="margin-top:12px;display:flex;gap:8px">
            <button type="button" class="btn" id="downloadPdfBtn">Download PDF</button>
            <button type="button" class="btn ghost" id="openPdfInNewTab">Open preview in new tab</button>
          </div>
        </div>

      </div>

      <!-- GLOBAL NAV CONTROLS -->
      <div class="controls" style="margin-top:12px">
        <button type="button" class="btn ghost" id="prevGlobal">Back</button>
        <button type="button" class="btn" id="nextGlobal">Next</button>
      </div>

      <div style="margin-top:14px;display:flex;justify-content:space-between;gap:8px">
        <div class="small muted">Tip: edit prices & package defaults near the top of the script.</div>
        <div style="display:flex;gap:8px">
          <button type="button" class="btn ghost" id="resetBtn">Reset</button>
        </div>
      </div>
    </div>

    <!-- RIGHT: Summary -->
    <div class="card summary">
      <h3>Live Quote</h3>
      <div id="summaryLines">
        <div class="line"><div class="muted">Customer</div><div id="sCustomer">-</div></div>
        <div class="line"><div class="muted">Event date</div><div id="sDate">-</div></div>
        <div class="line"><div class="muted">Guests</div><div id="sGuests">-</div></div>
        <div class="line"><div class="muted">Service</div><div id="sService">-</div></div>
        <div class="line"><div class="muted">Package</div><div id="sPackage">-</div></div>
        <div class="line"><div class="muted">Per head (total)</div><div id="sPerHead">-</div></div>
        <div class="line"><div class="muted">Drink surcharge</div><div id="sDrinks">£0.00</div></div>
        <div class="line"><div class="muted">Bread extras</div><div id="sBread">£0.00</div></div>
        <div class="line"><div class="muted">Buffet discount</div><div id="sBuffet">£0.00</div></div>
        <div class="line"><div class="muted">Add-ons (total)</div><div id="sAddons">£0.00</div></div>
        <div class="line"><div class="muted">Custom adjustments & specials</div><div id="sAdjust">£0.00</div></div>
        <div class="line"><div class="muted">Discount</div><div id="sDiscount">0%</div></div>
        <div class="line"><div class="muted big">Total</div><div id="sTotal" class="big">£0.00</div></div>
        <div style="margin-top:12px">
          <button type="button" class="btn" id="copyBill">Copy Bill</button>
          <button type="button" class="btn ghost" id="copyFull">Copy Full Quote</button>
          <button type="button" class="btn" id="openMenuBtn2" style="margin-left:6px">Open Menu</button>
        </div>
      </div>
      <div style="margin-top:12px" class="small muted">After picking dishes, totals refresh automatically. Go to the final step to download the PDF.</div>
    </div>
  </div>
</div>

<!-- Menu modal (full normalized menu) -->
<div class="menu-modal" id="menuModal" role="dialog" aria-modal="true">
  <div class="menu-panel card" role="document">
    <div class="menu-header">
      <div>
        <h3 style="margin:0">Full Menu — pick your items</h3>
        <div class="small muted">Click a card to select. Selected cards get highlighted. Limits enforced per chosen per-guest counts. Breads: one included free; up to 2 breads.</div>
      </div>
      <div style="display:flex;gap:8px;align-items:center">
        <div class="small muted">Selected: <span id="selCount">0</span></div>
        <button type="button" class="btn ghost" id="closeMenu">Close</button>
      </div>
    </div>

    <div style="display:flex;gap:8px;margin-bottom:12px;flex-wrap:wrap">
      <button type="button" class="btn ghost" data-cat="all">All</button>
      <button type="button" class="btn ghost" data-cat="juices">Standard Juices</button>
      <button type="button" class="btn ghost" data-cat="drinks">Drinks / Mocktails</button>
      <button type="button" class="btn ghost" data-cat="canapes">Canapés</button>
      <button type="button" class="btn ghost" data-cat="starters">Starters</button>
      <button type="button" class="btn ghost" data-cat="rice">Rice Dishes</button>
      <button type="button" class="btn ghost" data-cat="mains_nonveg">Main Courses (Non-Vegetarian)</button>
      <button type="button" class="btn ghost" data-cat="mains_veg">Main Courses (Vegetarian)</button>
      <button type="button" class="btn ghost" data-cat="desserts">Desserts</button>
      <button type="button" class="btn ghost" data-cat="breads">Breads</button>
      <button type="button" class="btn ghost" data-cat="selector">Selector Menus</button>
      <button type="button" class="btn ghost" data-cat="breakfast">Breakfast / Afternoon Tea</button>
    </div>

    <div id="menuContent" aria-live="polite"></div>

    <div class="menu-actions">
      <div class="small muted">Tip: choose up to the selected per-guest count in each category (unique items).</div>
      <div>
        <button type="button" class="btn ghost" id="clearSelections">Clear</button>
        <button type="button" class="btn" id="applySelections">Apply & Close</button>
      </div>
    </div>
  </div>
</div>

<script>
/* ================= BUTTON & FORM SAFETY ================= */
document.addEventListener("submit", e => { e.preventDefault(); e.stopPropagation(); }, true);
function forceButtonTypes() { document.querySelectorAll("button").forEach(b => b.type = "button"); }
forceButtonTypes();
new MutationObserver(forceButtonTypes).observe(document.body, { childList:true, subtree:true });

/* ================= HELPERS ================= */
const fmt = n => Number(n).toLocaleString(undefined,{minimumFractionDigits:2,maximumFractionDigits:2});
const CURRENCY = "£";

/* ================= WIZARD NAV ================= */
const steps = [...document.querySelectorAll(".step")];
let curStep = 0;
const stepText = document.getElementById("stepText");
const progBar = document.getElementById("progBar");

function onEnterStep(i){
  const pdfStepIndex = steps.length - 1;
  if(i === pdfStepIndex){
    renderPdfPreview();
  }
}

function showStep(i){
  steps.forEach((s,idx)=>s.classList.toggle("active",idx===i));
  curStep=i;
  stepText.textContent = `Step ${i+1} of ${steps.length}`;
  progBar.style.width = `${(i/(steps.length-1))*100}%`;
  onEnterStep(i);
}
showStep(0);

document.getElementById("nextGlobal").onclick = () => {
  if(curStep < steps.length-1) showStep(curStep+1);
  else computeQuote();
};
document.getElementById("prevGlobal").onclick = () => {
  if(curStep>0) showStep(curStep-1);
};

/* ================= PRICING & PACKAGE DEFAULTS ================= */
const PRICING = {
  packages:{
    Bronze:30, Silver:32, Gold:35, Diamond:40, Platinum:45,
    "Crystal (Selector)":0, "Pearl (Selector)":0,
    "Breakfast / Afternoon Tea":0,
    "Deluxe Breakfast Menu":0,
    "Deluxe Mehndi Menu":0,
    Standard:0, Custom:15
  },
  under100Surcharge:3,
  changeAddSubPerHead:2,           // used for package customisation & second bread per-head extra
  specialItemPerHead:2,            // special item surcharge per head
  drinkSurchargePerSelectedDrinkPerHead:1, // £1 per selected juice/mocktail per head
  buffetDiscountPerHead:3          // buffet reduces £3/head
};

const PACKAGE_DEFAULTS = {
  Bronze:{canapes:0,starters:2,mains:2,desserts:1},
  Silver:{canapes:0,starters:3,mains:3,desserts:2},
  Gold:{canapes:0,starters:4,mains:4,desserts:2},
  Diamond:{canapes:2,starters:4,mains:4,desserts:3},
  Platinum:{canapes:3,starters:5,mains:5,desserts:3},
  Standard:{canapes:0,starters:1,mains:2,desserts:1},
  Custom:{canapes:0,starters:0,mains:0,desserts:0}
};

/* ================= ELEMENTS ================= */
const guestsEl = document.getElementById("guests");
const packageSelect = document.getElementById("packageSelect"); // hidden but used by logic
const lockPackage = document.getElementById("lockPackage");
const nCanapes = document.getElementById("nCanapes");
const nStarters = document.getElementById("nStarters");
const nMains = document.getElementById("nMains");
const nDesserts = document.getElementById("nDesserts");

const custName = document.getElementById('custName');
const custEmail = document.getElementById('custEmail');
const custPhone = document.getElementById('custPhone');
const custAddress = document.getElementById('custAddress');
const custDate = document.getElementById('custDate');

const discountPctEl = document.getElementById('discountPct');
const pdfPreviewEl = document.getElementById('pdfPreview');

/* Populate hidden package select (compat) */
for(const k in PRICING.packages){
  const opt = document.createElement("option");
  opt.value = k;
  const p = PRICING.packages[k];
  opt.textContent = p>0 ? `${k} — £${p}/head` : `${k} — price on request`;
  packageSelect.appendChild(opt);
}

/* Helpers for package defaults and lock */
function applyPackageDefaults(pkg){
  const d = PACKAGE_DEFAULTS[pkg];
  if(!d) return;
  nCanapes.value = d.canapes;
  nStarters.value = d.starters;
  nMains.value = d.mains;
  nDesserts.value = d.desserts;
}
function updateLock(){
  const locked = lockPackage.checked && packageSelect.value!=="Custom";
  [nCanapes,nStarters,nMains,nDesserts].forEach(i=>i.disabled=locked);
  if(locked) applyPackageDefaults(packageSelect.value);
}
packageSelect.onchange = () => {
  applyPackageDefaults(packageSelect.value);
  updateLock();
  const removed = enforceSelectionLimits();
  if(removed > 0) alert(`${removed} previously selected item(s) were removed to fit the new package limits.`);
  computeQuote();
};
lockPackage.onchange = () => { updateLock(); computeQuote(); };

/* Render packages as cards */
const packagesGrid = document.getElementById('packagesGrid');
function renderPackagesGrid(){
  packagesGrid.innerHTML = '';
  Object.keys(PRICING.packages).forEach(pkgName => {
    const price = PRICING.packages[pkgName];
    const defaults = PACKAGE_DEFAULTS[pkgName] || {canapes:0,starters:0,mains:0,desserts:0};
    const card = document.createElement('div');
    card.className = 'package-card';
    card.dataset.pkg = pkgName;
    const h = document.createElement('h4');
    h.textContent = pkgName;
    card.appendChild(h);
    const mh = document.createElement('div');
    mh.className = 'meta';
    mh.innerHTML = `Canapés: <strong>${defaults.canapes}</strong> · Starters: <strong>${defaults.starters}</strong><br>Mains: <strong>${defaults.mains}</strong> · Desserts: <strong>${defaults.desserts}</strong>`;
    card.appendChild(mh);
    const ph = document.createElement('div');
    ph.className = 'perhead';
    ph.textContent = price>0 ? `£${price}/head` : 'Price on request';
    card.appendChild(ph);

    if(packageSelect.value === pkgName){
      card.classList.add('selected');
    }

    card.addEventListener('click', () => {
      document.querySelectorAll('.package-card').forEach(c=>c.classList.remove('selected'));
      card.classList.add('selected');
      packageSelect.value = pkgName;
      lockPackage.checked = true;
      updateLock();
      applyPackageDefaults(pkgName);
      packageSelect.dispatchEvent(new Event('change', { bubbles: true }));
      computeQuote();
    });

    packagesGrid.appendChild(card);
  });
}

/* ================= FULL MENU (with breads) ================= */
const MENU = [
  /* juices */
  {id:'j_mango', name:'Mango Juice', category:'juices', special:false},
  {id:'j_lychee', name:'Lychee Juice', category:'juices', special:false},
  {id:'j_passion', name:'Passion Fruit Juice', category:'juices', special:false},
  {id:'j_tropical', name:'Tropical Fruit Juice', category:'juices', special:false},
  {id:'j_pomegranate', name:'Pomegranate Juice', category:'juices', special:false},
  {id:'j_pineapple_coco', name:'Pineapple & Coconut', category:'juices', special:false},
  {id:'j_mango_coco', name:'Mango & Coconut', category:'juices', special:false},
  {id:'j_mango_lime_mint', name:'Mango, Lime & Mint', category:'juices', special:false},
  {id:'j_guanabana', name:'Guanabana', category:'juices', special:false},
  {id:'j_guava', name:'Guava', category:'juices', special:false},

  /* drinks / mocktails */
  {id:'d_virgin_mojito', name:'Virgin Mojito (Mocktail)', category:'drinks', special:false},
  {id:'d_strawberry_daiquiri', name:'Strawberry Daiquiri (Mocktail)', category:'drinks', special:false},
  {id:'d_cherry_daiquiri', name:'Cherry Daiquiri (Mocktail)', category:'drinks', special:false},
  {id:'d_blueberry_mojito', name:'Blueberry Mojito (Mocktail)', category:'drinks', special:false},
  {id:'d_pina_colada', name:'Pina Colada (Mocktail)', category:'drinks', special:false},
  {id:'d_lychee_mojito', name:'Lychee Mojito (Mocktail)', category:'drinks', special:false},
  {id:'d_rooh_afza', name:'Rooh Afza', category:'drinks', special:false},
  {id:'d_lassi', name:'Lassi (Mango, Strawberry, Sweet)', category:'drinks', special:false},
  {id:'d_nimbu_pani', name:'Nimbu Pani (Shikanji)', category:'drinks', special:false},

  /* CANAPÉS (merged) */
  {id:'c_pani_puri', name:'Pani Puri (Gol Gappa)', category:'canapes', special:false},
  {id:'c_vegetable_samosa', name:'Vegetable Samosa', category:'canapes', special:false},
  {id:'c_alu_tikki', name:'Alu Tikki', category:'canapes', special:false},
  {id:'c_samosa_chat', name:'Samosa Chat', category:'canapes', special:true},
  {id:'c_papri_chat', name:'Papri Chat', category:'canapes', special:false},
  {id:'c_chilli_paneer', name:'Chilli Paneer', category:'canapes', special:false},
  {id:'c_mogo_fries', name:'Mogo Fries', category:'canapes', special:false},
  {id:'c_pakora', name:'Pakora', category:'canapes', special:false},
  {id:'c_mozzarella_sticks', name:'Mozzarella Sticks', category:'canapes', special:true},
  {id:'c_halloumi_fries', name:'Halloumi Fries', category:'canapes', special:true},
  {id:'c_falafel', name:'Falafel', category:'canapes', special:true},
  {id:'c_chicken_popcorn', name:'Chicken Popcorn', category:'canapes', special:false},
  {id:'c_malai_tikka', name:'Malai Tikka', category:'canapes', special:false},
  {id:'c_mini_burger', name:'Mini Burgers', category:'canapes', special:false},
  {id:'c_chicken_pakora', name:'Chicken Pakora', category:'canapes', special:true},
  {id:'c_mango_chilli_chicken', name:'Mango Chilli Chicken', category:'canapes', special:true},
  {id:'c_spring_rolls', name:'Spring Rolls', category:'canapes', special:false},
  {id:'c_tempura_prawns', name:'Tempura Prawns', category:'canapes', special:true},
  {id:'c_tempura_chicken', name:'Tempura Chicken', category:'canapes', special:false},
  {id:'c_murgh_tilwala', name:'Murgh Tilwala', category:'canapes', special:true},
  {id:'c_mini_tacos', name:'Mini Tacos', category:'canapes', special:true},
  {id:'c_meat_samosa', name:'Chicken / Lamb Samosa', category:'canapes', special:false},
  {id:'c_masala_fish_chips', name:'Masala Fish & Chips', category:'canapes', special:false},

  /* STARTERS (merged) */
  {id:'s_garlic_chilli_mushrooms', name:'Garlic & Chilli Mushrooms', category:'starters', special:false},
  {id:'s_mogo_chips', name:'Mogo Chips', category:'starters', special:false},
  {id:'s_tempura_veg', name:'Tempura Vegetables', category:'starters', special:false},
  {id:'s_vegetable_samosa_starter', name:'Vegetable Samosas', category:'starters', special:false},
  {id:'s_paneer_samosa', name:'Paneer Samosas', category:'starters', special:true},
  {id:'s_vegetable_spring_rolls', name:'Vegetable Spring Rolls', category:'starters', special:false},
  {id:'s_corn_palak_pakoras', name:'Corn & Palak Pakoras', category:'starters', special:true},
  {id:'s_khatte_aloo_ki_papdi', name:'Khatte Aloo Ki Papdi', category:'starters', special:false},
  {id:'s_bharwa_aloo', name:'Bharwa Aloo', category:'starters', special:true},
  {id:'s_chilli_paneer_starter', name:'Chilli Paneer', category:'starters', special:false},
  {id:'s_mixed_pakora', name:'Mixed Pakora', category:'starters', special:false},
  {id:'s_alu_papri_chaat', name:'Alu Papri Chaat', category:'starters', special:false},
  {id:'s_dahi_bhallay', name:'Dahi Bhallay', category:'starters', special:false},
  {id:'s_bhel_puri', name:'Bhel Puri', category:'starters', special:false},
  {id:'s_chicken_tikka', name:'Chicken Tikka', category:'starters', special:false},
  {id:'s_peri_peri_wings', name:'Peri Peri Chicken Wings', category:'starters', special:false},
  {id:'s_seekh_kebab', name:'Seekh Kebab', category:'starters', special:false},
  {id:'s_reshmi_kebab', name:'Reshmi Kebab', category:'starters', special:false},
  {id:'s_chicken_chargah', name:'Chicken Chargah', category:'starters', special:false},
  {id:'s_masala_fish', name:'Masala Fish', category:'starters', special:false},
  {id:'s_afghani_lamb_tikka', name:'Afghani Lamb Tikka', category:'starters', special:true},
  {id:'s_peshwari_chapli_kebabs', name:'Peshwari Chapli Kebabs', category:'starters', special:false},
  {id:'s_lamb_ribs', name:'Lamb Ribs', category:'starters', special:true},
  {id:'s_lamb_fillets', name:'Lamb Fillets', category:'starters', special:true},
  {id:'s_tandoori_lamb_chops', name:'Tandoori Lamb Chops', category:'starters', special:true},
  {id:'s_garlic_chilli_prawns', name:'Garlic & Chilli Prawns', category:'starters', special:true},
  {id:'s_meat_samosa_starter', name:'Chicken / Lamb Samosa', category:'starters', special:false},

  /* RICE & MAINS & DESSERTS unchanged */
  {id:'r_jeera', name:'Jeera Rice', category:'rice', special:false},
  {id:'r_plain', name:'Plain Rice', category:'rice', special:false},
  {id:'r_matar_pilau', name:'Matar Pilau', category:'rice', special:false},
  {id:'r_saffron', name:'Saffron Rice', category:'rice', special:false},
  {id:'r_chicken_pilau', name:'Chicken Pilau', category:'rice', special:false},
  {id:'r_lamb_pilau', name:'Lamb Pilau', category:'rice', special:false},
  {id:'r_prawn_biryani', name:'Prawn Biryani*', category:'rice', special:true},
  {id:'r_chicken_biryani', name:'Chicken Biryani', category:'rice', special:false},
  {id:'r_lamb_biryani', name:'Lamb Biryani', category:'rice', special:true},
  {id:'r_veg_biryani', name:'Vegetable Biryani', category:'rice', special:false},
  {id:'r_egg_fried_rice', name:'Egg Fried Rice', category:'rice', special:false},

  {id:'m_lamb_korma', name:'Lamb Korma', category:'mains_nonveg', special:false},
  {id:'m_karahi_gosht', name:'Karahi Gosht', category:'mains_nonveg', special:false},
  {id:'m_chilli_lamb', name:'Chilli Lamb', category:'mains_nonveg', special:false},
  {id:'m_bhuna_gosht', name:'Bhuna Gosht', category:'mains_nonveg', special:false},
  {id:'m_saag_gosht', name:'Saag Gosht', category:'mains_nonveg', special:false},
  {id:'m_achari_gosht', name:'Achari Gosht', category:'mains_nonveg', special:false},
  {id:'m_keema_mattar', name:'Keema Mattar', category:'mains_nonveg', special:false},
  {id:'m_kofta_anda', name:'Kofta & Anda Curry', category:'mains_nonveg', special:false},
  {id:'m_methi_lamb', name:'Methi Lamb', category:'mains_nonveg', special:false},
  {id:'m_nargisi_kofta', name:'Nargisi Kofta*', category:'mains_nonveg', special:true},
  {id:'m_keema', name:'Kofta Curry', category:'mains_nonveg', special:false},
  {id:'m_lahori_nehari', name:'Lahori Nehari*', category:'mains_nonveg', special:true},
  {id:'m_lamb_haleem', name:'Lamb Haleem', category:'mains_nonveg', special:false},
  {id:'m_afghani_lamb_karahi', name:'Afghani Lamb Karahi', category:'mains_nonveg', special:false},
  {id:'m_lamb_chops_masala', name:'Lamb Chops Masala*', category:'mains_nonveg', special:true},
  {id:'m_karahi_chicken', name:'Karahi Chicken', category:'mains_nonveg', special:false},
  {id:'m_achari_chicken', name:'Achari Chicken', category:'mains_nonveg', special:false},
  {id:'m_jalfrezi_chicken', name:'Chicken Jalfrezi', category:'mains_nonveg', special:false},
  {id:'m_tikka_karahi', name:'Chicken Tikka Karahi', category:'mains_nonveg', special:false},
  {id:'m_methi_chicken', name:'Methi Chicken', category:'mains_nonveg', special:false},
  {id:'m_palak_chicken', name:'Palak Chicken', category:'mains_nonveg', special:false},
  {id:'m_chicken_keema', name:'Chicken Keema', category:'mains_nonveg', special:false},
  {id:'m_makhni_chicken', name:'Makhni Chicken*', category:'mains_nonveg', special:true},
  {id:'m_chicken_korma', name:'Chicken Korma', category:'mains_nonveg', special:false},
  {id:'m_shashlik', name:'Chicken Shashlik', category:'mains_nonveg', special:false},
  {id:'m_chilli_chicken', name:'Chilli Chicken', category:'mains_nonveg', special:false},
  {id:'m_manpasand_kofta', name:'Manpasand Kofta', category:'mains_nonveg', special:false},
  {id:'m_chicken_haleem', name:'Chicken Haleem', category:'mains_nonveg', special:false},
  {id:'m_chicken_ginger', name:'Chicken Ginger', category:'mains_nonveg', special:false},
  {id:'m_prawn_masala', name:'Prawn Masala*', category:'mains_nonveg', special:true},
  {id:'m_makhni_prawns', name:'Makhni Prawns*', category:'mains_nonveg', special:true},
  {id:'m_fish_karahi', name:'Fish Karahi*', category:'mains_nonveg', special:true},

  {id:'v_achari_aloo', name:'Achari Aloo', category:'mains_veg', special:false},
  {id:'v_aloo_chana', name:'Aloo Chana', category:'mains_veg', special:false},
  {id:'v_aloo_gobi', name:'Aloo Gobi', category:'mains_veg', special:false},
  {id:'v_aloo_mattar', name:'Aloo Mattar', category:'mains_veg', special:false},
  {id:'v_dum_aloo', name:'Dum Aloo', category:'mains_veg', special:false},
  {id:'v_aloo_palak', name:'Aloo Palak', category:'mains_veg', special:false},
  {id:'v_bhaingan_bhartha', name:'Bhaingan Ka Bhartha', category:'mains_veg', special:false},
  {id:'v_palak_paneer', name:'Palak Paneer', category:'mains_veg', special:false},
  {id:'v_mattar_paneer', name:'Mutter Paneer', category:'mains_veg', special:false},
  {id:'v_bharwa_potato', name:'Bharwa Aloo (Stuffed)', category:'mains_veg', special:false},
  {id:'v_malai_kofta', name:'Malai Kofta', category:'mains_veg', special:false},
  {id:'v_veg_jalfrezi', name:'Mixed Vegetable Jalfrezi', category:'mains_veg', special:false},
  {id:'v_raajma', name:'Rajmah', category:'mains_veg', special:false},
  {id:'v_kadhi_pakoras', name:'Kadhi Pakoras', category:'mains_veg', special:false},
  {id:'v_karahi_mushroom', name:'Karahi Mushroom', category:'mains_veg', special:false},

  {id:'dess_gajar', name:'Gajjar Ka Halwa', category:'desserts', special:false},
  {id:'dess_gulab', name:'Gulab Jamun', category:'desserts', special:false},
  {id:'dess_suji', name:'Suji Ka Halwa', category:'desserts', special:false},
  {id:'dess_rasgulla', name:'Rasgulla', category:'desserts', special:false},
  {id:'dess_rasmali', name:'Ras Malai', category:'desserts', special:false},
  {id:'dess_mutanjan', name:'Mutanjan', category:'desserts', special:false},
  {id:'dess_bakhlawa', name:'Bakhlawa', category:'desserts', special:false},
  {id:'dess_barfi', name:'Barfi', category:'desserts', special:false},
  {id:'dess_jalebi', name:'Jalebi', category:'desserts', special:false},
  {id:'dess_kheer', name:'Kheer / Firni', category:'desserts', special:false},
  {id:'dess_shrikhand', name:'Shrikhand', category:'desserts', special:false},
  {id:'dess_icecream', name:'Selection of Ice Cream', category:'desserts', special:false},
  {id:'dess_malai_kulfi', name:'Malai Kulfi', category:'desserts', special:false},
  {id:'dess_rose_kulfi', name:'Rose Kulfi*', category:'desserts', special:true},
  {id:'dess_saffron_kulfi', name:'Saffron Kulfi*', category:'desserts', special:true},
  {id:'dess_pistachio_kulfi', name:'Pistachio Kulfi*', category:'desserts', special:true},

  /* SELECTOR / BREAKFAST unchanged */
  {id:'sel_dawat_trio', name:'Dawat Trio Platter', category:'selector', special:false},
  {id:'sel_cheesecake', name:'Selection of Cheesecake', category:'selector', special:false},
  {id:'sel_macarons', name:'Selection of Macarons', category:'selector', special:false},
  {id:'break_punjabi_pakoras', name:'Punjabi Style Pakoras (Breakfast)', category:'breakfast', special:false},
  {id:'break_deluxe', name:'Deluxe Breakfast Menu (assorted)', category:'breakfast', special:false},
  {id:'mehandi_deluxe', name:'Deluxe Mehndi Menu', category:'breakfast', special:false},

  /* breads (new) */
  {id:'b_tandoori_naan', name:'Tandoori Naan', category:'breads', special:false},
  {id:'b_methi_naan', name:'Methi Naan', category:'breads', special:true},
  {id:'b_garlic_naan', name:'Garlic Naan', category:'breads', special:true},
  {id:'b_garlic_chilli_naan', name:'Garlic & Chilli Naan', category:'breads', special:true},
  {id:'b_peshwari_naan', name:'Peshwari Naan', category:'breads', special:true},
  {id:'b_roghni_naans', name:'Roghni Naans', category:'breads', special:true},
  {id:'b_romali_roti', name:'Romali Roti', category:'breads', special:false},
  {id:'b_lachedar_parathas', name:'Lachedar Parathas', category:'breads', special:true},
  {id:'b_tandoori_parathas', name:'Tandoori Parathas', category:'breads', special:true},
  {id:'b_bhaturras', name:'Bhaturras', category:'breads', special:true},
  {id:'b_puris', name:'Puris', category:'breads', special:false},
  {id:'b_makki_roti', name:'Makki Ki Roti', category:'breads', special:true}
];

/* ================= MENU RENDERING & SELECTION ENFORCEMENT ================= */
const menuContent = document.getElementById("menuContent");
const selCountEl = document.getElementById("selCount");
window.SELECTED_MENU_ITEMS = [];

function getLimits(){
  return {
    canapes: Number(nCanapes.value) || 0,
    starters: Number(nStarters.value) || 0,
    mains: Number(nMains.value) || 0,
    desserts: Number(nDesserts.value) || 0
  };
}
function countSelectedByCategory(cat){
  return window.SELECTED_MENU_ITEMS.filter(i => i.category === cat).length;
}
function countSelectedMainsTotal(){
  return window.SELECTED_MENU_ITEMS.filter(i => ['mains_nonveg','mains_veg','rice'].includes(i.category)).length;
}

function enforceSelectionLimits(){
  const limits = getLimits();
  const counts = { canapes:0, starters:0, desserts:0, mains:0, breads:0 };
  const kept = [];
  const removed = [];

  for(const item of window.SELECTED_MENU_ITEMS){
    const cat = item.category;
    if(cat === 'canapes'){
      if(counts.canapes < limits.canapes){ kept.push(item); counts.canapes++; } else removed.push(item);
    } else if(cat === 'starters'){
      if(counts.starters < limits.starters){ kept.push(item); counts.starters++; } else removed.push(item);
    } else if(cat === 'desserts'){
      if(counts.desserts < limits.desserts){ kept.push(item); counts.desserts++; } else removed.push(item);
    } else if(['mains_nonveg','mains_veg','rice'].includes(cat)){
      if(counts.mains < limits.mains){ kept.push(item); counts.mains++; } else removed.push(item);
    } else if(cat === 'breads'){
      if(counts.breads < 2){ kept.push(item); counts.breads++; } else removed.push(item);
    } else {
      kept.push(item);
    }
  }

  window.SELECTED_MENU_ITEMS = kept;
  selCountEl.textContent = window.SELECTED_MENU_ITEMS.length;
  populateMenuItems(currentFilter);
  return removed.length;
}

/* Render menu items into modal */
let currentFilter = 'all';
function populateMenuItems(filter = 'all'){
  currentFilter = filter;
  menuContent.innerHTML = '';
  const grid = document.createElement('div');
  grid.className = 'menu-grid';
  const items = (filter === 'all') ? MENU : MENU.filter(i => i.category === filter);

  items.forEach(item => {
    const card = document.createElement('div');
    card.className = 'menu-card';
    card.dataset.id = item.id;
    card.dataset.cat = item.category;
    const h = document.createElement('h4');
    h.textContent = item.name;
    card.appendChild(h);
    const p = document.createElement('p');
    p.textContent = item.category.replace(/_/g,' ').replace(/\b\w/g, c=>c.toUpperCase());
    card.appendChild(p);
    if(item.special){
      const sp = document.createElement('div');
      sp.className = 'price';
      sp.textContent = 'Special';
      card.appendChild(sp);
    }
    if(window.SELECTED_MENU_ITEMS.find(si => si.id === item.id)){
      card.classList.add('selected');
      const badge = document.createElement('div');
      badge.className = 'selBadge';
      badge.textContent = 'Selected';
      card.appendChild(badge);
    }

    card.addEventListener('click', () => {
      const isSelected = window.SELECTED_MENU_ITEMS.find(si => si.id === item.id);
      if(isSelected){
        window.SELECTED_MENU_ITEMS = window.SELECTED_MENU_ITEMS.filter(si => si.id !== item.id);
        populateMenuItems(currentFilter);
        selCountEl.textContent = window.SELECTED_MENU_ITEMS.length;
        return;
      }

      const limits = getLimits();
      if(item.category === 'canapes'){
        if(countSelectedByCategory('canapes') >= limits.canapes){
          alert(`Canapés limit reached (${limits.canapes} unique items). Remove an existing one to add another.`);
          return;
        }
      } else if(item.category === 'starters'){
        if(countSelectedByCategory('starters') >= limits.starters){
          alert(`Starters limit reached (${limits.starters} unique items). Remove an existing one to add another.`);
          return;
        }
      } else if(item.category === 'desserts'){
        if(countSelectedByCategory('desserts') >= limits.desserts){
          alert(`Desserts limit reached (${limits.desserts} unique items). Remove an existing one to add another.`);
          return;
        }
      } else if(['mains_nonveg','mains_veg','rice'].includes(item.category)){
        if(countSelectedMainsTotal() >= limits.mains){
          alert(`Mains limit reached (${limits.mains} unique items across mains & rice). Remove an existing main/rice to add another.`);
          return;
        }
      } else if(item.category === 'breads'){
        if(countSelectedByCategory('breads') >= 2){
          alert(`Breads limit reached (max 2 choices). Remove an existing bread to add another.`);
          return;
        }
      }
      window.SELECTED_MENU_ITEMS.push(item);
      populateMenuItems(currentFilter);
      selCountEl.textContent = window.SELECTED_MENU_ITEMS.length;
    });

    grid.appendChild(card);
  });

  menuContent.appendChild(grid);
}

/* Wire category buttons */
document.querySelectorAll('.menu-panel button[data-cat]').forEach(btn => {
  btn.addEventListener('click', () => {
    const cat = btn.dataset.cat;
    document.querySelectorAll('.menu-panel button[data-cat]').forEach(b=>b.classList.remove('active'));
    btn.classList.add('active');
    populateMenuItems(cat === 'all' ? 'all' : cat);
  });
});

/* Open/close modal & apply/clear */
const menuModal = document.getElementById("menuModal");
function openMenu() {
  if (!menuModal) return;
  populateMenuItems('all');
  selCountEl.textContent = window.SELECTED_MENU_ITEMS.length;
  menuModal.style.display = "flex";
}
function closeMenuModal() {
  if (!menuModal) return;
  menuModal.style.display = "none";
}
["openMenuBtn", "openMenuBtnInline", "openMenuBtn2"].forEach(id => {
  const btn = document.getElementById(id);
  if (btn) btn.addEventListener("click", openMenu);
});
const closeMenuBtn = document.getElementById("closeMenu");
if (closeMenuBtn) closeMenuBtn.addEventListener("click", closeMenuModal);
document.addEventListener("keydown", e => { if (e.key === "Escape") closeMenuModal(); });
document.getElementById('clearSelections').addEventListener('click', () => { window.SELECTED_MENU_ITEMS = []; selCountEl.textContent = '0'; populateMenuItems(currentFilter); });
document.getElementById('applySelections').addEventListener('click', () => { closeMenuModal(); computeQuote(); });

/* Re-enforce limits if per-category inputs change */
[nCanapes,nStarters,nMains,nDesserts].forEach(el => {
  el.addEventListener('change', () => {
    const removed = enforceSelectionLimits();
    if(removed>0) alert(`${removed} previously selected item(s) were removed to fit the new limits.`);
    computeQuote();
  });
});

/* ================= CALCULATION (with breads handling + buffet discount) ================= */
function computeQuote(){
  const guests = Number(guestsEl.value)||1;
  const pkg = packageSelect.value || 'Bronze';
  let base = PRICING.packages[pkg]||0;

  if(["Bronze","Silver","Gold","Diamond","Platinum"].includes(pkg) && guests<100){
    base += PRICING.under100Surcharge;
  }

  let adjustmentsPerHead=0;
  if(!lockPackage.checked && PACKAGE_DEFAULTS[pkg]){
    const d=PACKAGE_DEFAULTS[pkg];
    adjustmentsPerHead += (
      Math.abs(Number(nCanapes.value)-d.canapes)+
      Math.abs(Number(nStarters.value)-d.starters)+
      Math.abs(Number(nMains.value)-d.mains)+
      Math.abs(Number(nDesserts.value)-d.desserts)
    )*PRICING.changeAddSubPerHead;
  }

  // Add-ons (absolute totals)
  const addonVal1 = Number(document.getElementById('addonVal1').value)||0;
  const addonVal2 = Number(document.getElementById('addonVal2').value)||0;
  const addonVal3 = Number(document.getElementById('addonVal3').value)||0;
  const addonsTotal = addonVal1 + addonVal2 + addonVal3;

  // Special items surcharge: each special selected adds X per head (includes bread specials)
  const specialCount = window.SELECTED_MENU_ITEMS.filter(i => i.special).length;
  const specialPerHead = specialCount * PRICING.specialItemPerHead;

  // Drinks surcharge: £1/head for every selected juice/mocktail type
  const drinkCount = window.SELECTED_MENU_ITEMS.filter(i => ['juices','drinks'].includes(i.category)).length;
  const drinksPerHead = drinkCount * PRICING.drinkSurchargePerSelectedDrinkPerHead;
  const drinksTotal = drinksPerHead * guests;

  // Breads handling:
  const breadItems = window.SELECTED_MENU_ITEMS.filter(i => i.category === 'breads');
  const breadCount = breadItems.length;
  // One bread included free; any extra breads beyond the first add changeAddSubPerHead per head
  const extraBreadChoices = Math.max(0, breadCount - 1);
  const extraBreadPerHead = extraBreadChoices * PRICING.changeAddSubPerHead;
  const breadExtraTotal = extraBreadPerHead * guests;

  // Service-based buffet discount per head (NEW)
  const service = document.querySelector('input[name="service"]:checked')?.value || 'table';
  const buffetPerHead = (service === 'buffet') ? PRICING.buffetDiscountPerHead : 0;
  const buffetTotal = buffetPerHead * guests;

  // Per-head total before clamping (base + adjustments + specials + drinks - buffet discount + extra bread per head)
  let perHead = base + adjustmentsPerHead + specialPerHead + drinksPerHead - buffetPerHead + extraBreadPerHead;
  if(perHead < 0) perHead = 0; // clamp to avoid negative per-head

  const foodTotal = perHead * guests;

  // Pre-discount grand total (no waiters)
  const preDiscountGrand = foodTotal + addonsTotal;

  // Discount percentage: allow 0 (no discount) or enforce min 5% if >0; max 50%
  let discountPct = Number(discountPctEl.value) || 0;
  if(discountPct > 0 && discountPct < 5) discountPct = 5;
  if(discountPct > 50) discountPct = 50;
  discountPctEl.value = discountPct;

  const discountAmount = preDiscountGrand * (discountPct/100);
  const grandTotal = preDiscountGrand - discountAmount;

  // Update summary display
  const cust = (custName.value || '').trim();
  document.getElementById("sCustomer").textContent = cust ? `${cust}` : '-';
  document.getElementById("sDate").textContent = (custDate.value || '-') ;
  document.getElementById("sGuests").textContent = guests;
  document.getElementById("sService").textContent = service;
  document.getElementById("sPackage").textContent = pkg;
  document.getElementById("sPerHead").textContent = `£${fmt(perHead)}`;
  document.getElementById("sDrinks").textContent = `£${fmt(drinksTotal)}`;
  document.getElementById("sBread").textContent = breadExtraTotal > 0 ? `£${fmt(breadExtraTotal)}` : '£0.00';
  document.getElementById("sBuffet").textContent = buffetTotal>0 ? `-£${fmt(buffetTotal)}` : '£0.00';
  document.getElementById("sAddons").textContent = `£${fmt(addonsTotal)}`;
  document.getElementById("sAdjust").textContent = `£${fmt((adjustmentsPerHead + specialPerHead) * guests)}`;
  document.getElementById("sDiscount").textContent = `${discountPct}%`;
  document.getElementById("sTotal").textContent = `£${fmt(grandTotal)}`;

  return {
    guests, service, pkg, perHead, drinksPerHead, drinksTotal, addonsTotal,
    adjustmentsPerHead, specialPerHead, grandTotal, foodTotal, preDiscountGrand, discountPct, discountAmount,
    buffetPerHead, buffetTotal, breadCount, extraBreadPerHead, breadExtraTotal
  };
}

/* ================= COPY (bill & full) ================= */
document.getElementById("copyBill").onclick = () => {
  const t = document.getElementById("sTotal").textContent;
  navigator.clipboard.writeText(t).then(()=> alert("Total copied to clipboard")).catch(()=> alert("Copy failed"));
};

document.getElementById("copyFull").onclick = async () => {
  const b = computeQuote(); // ensure latest
  const out = buildPlainTextQuote(b);
  try {
    await navigator.clipboard.writeText(out);
    alert('Full quote copied to clipboard');
  } catch(e){
    const win = window.open('', '_blank', 'noopener');
    if(win){
      win.document.write('<pre style="white-space:pre-wrap; font-family:monospace;">' + out.replace(/&/g,'&amp;').replace(/</g,'&lt;') + '</pre>');
      win.document.title = 'Full Quote - Copy';
    } else {
      alert('Unable to copy automatically — your browser blocked clipboard. A new tab has been opened with the quote (or copy manually).');
    }
  }
};

function buildPlainTextQuote(b){
  const lines = [];
  lines.push(`Dawat:The Art of Cooking — Catering Quote`);
  lines.push('');
  lines.push('Customer:');
  lines.push(`  Name: ${custName.value || '-'}`);
  lines.push(`  Email: ${custEmail.value || '-'}`);
  lines.push(`  Phone: ${custPhone.value || '-'}`);
  lines.push(`  Event date: ${custDate.value || '-'}`);
  lines.push(`  Address: ${custAddress.value || '-'}`);
  lines.push('');
  lines.push(`Guests: ${b.guests}`);
  lines.push(`Service: ${b.service}`);
  lines.push(`Package: ${b.pkg}`);
  lines.push('');
  lines.push(`Per-head breakdown:`);
  lines.push(`  Base package: £${fmt(PRICING.packages[b.pkg] || 0)} per head`);
  if(["Bronze","Silver","Gold","Diamond","Platinum"].includes(b.pkg) && b.guests < 100){
    lines.push(`  Under-100 surcharge: £${fmt(PRICING.under100Surcharge)} per head (applied)`);
  }
  lines.push(`  Custom adjustments: £${fmt(b.adjustmentsPerHead)} per head`);
  lines.push(`  Special items surcharge: £${fmt(b.specialPerHead)} per head`);
  lines.push(`  Drinks surcharge: £${fmt(b.drinksPerHead)} per head`);
  if(b.buffetPerHead > 0){
    lines.push(`  Buffet discount: -£${fmt(b.buffetPerHead)} per head (applied)`);
  }
  if(b.extraBreadPerHead > 0){
    lines.push(`  Additional bread choices: £${fmt(b.extraBreadPerHead)} per head (applied for ${b.breadCount} breads)`);
  }
  lines.push(`  Total per head: £${fmt(b.perHead)}`);
  lines.push('');
  lines.push('Totals:');
  lines.push(`  Food total: £${fmt(b.foodTotal)}`);
  lines.push(`  Add-ons (total): £${fmt(b.addonsTotal)}`);
  lines.push(`  Subtotal: £${fmt(b.preDiscountGrand)}`);
  lines.push(`  Discount: ${b.discountPct}% → -£${fmt(b.discountAmount)}`);
  lines.push(`  Grand total: £${fmt(b.grandTotal)}`);
  lines.push('');

  if(b.service === 'table'){
    lines.push('Table service — Event Management & Staffing:');
    lines.push('  We will provide complete Event Management inclusive of onsite Event Managers, Waiters For Service, Kitchen Chefs and Crew. We will provide the Crockery, Cutlery, Glassware, Table Linens and Napkins.');
    lines.push('  Our designated staff will be able to serve and service your Event respectively throughout the day to the highest of standards. This includes setting up, winding down and ensuring complete execution of the Event meticulously whereby we take care of everything from Start to Finish.');
    lines.push('');
  } else {
    lines.push('Buffet service — Event Management & Staffing:');
    lines.push('  For buffet service we provide Event Management inclusive of onsite Event Managers, Buffet Attendants and Kitchen Crew. We will supply Crockery, Cutlery, Glassware where required, plus all necessary buffet equipment and replenishment service.');
    lines.push('  Our team will ensure dishes are replenished, temperature-controlled and presented attractively throughout service, handling setup and breakdown to guarantee a smooth buffet experience.');
    lines.push('');
  }

  if(window.SELECTED_MENU_ITEMS.length){
    lines.push('Selected menu items:');
    const byCat = {};
    window.SELECTED_MENU_ITEMS.forEach(it => {
      if(!byCat[it.category]) byCat[it.category] = [];
      byCat[it.category].push(it);
    });
    const catOrder = ['canapes','starters','mains_nonveg','mains_veg','rice','desserts','breads','juices','drinks','selector','breakfast'];
    catOrder.forEach(cat => {
      if(byCat[cat] && byCat[cat].length){
        lines.push(`  ${cat.replace(/_/g,' ')}:`);
        byCat[cat].forEach(it => lines.push(`    - ${it.name}${it.special? ' *special*' : ''}`));
      }
    });
    Object.keys(byCat).forEach(cat => {
      if(!catOrder.includes(cat)){
        lines.push(`  ${cat}:`);
        byCat[cat].forEach(it => lines.push(`    - ${it.name}${it.special? ' *special*' : ''}`));
      }
    });
    lines.push('');
  }

  // Add-ons detail
  const addonLines = [];
  const al1 = (document.getElementById('addonLabel1').value || '').trim();
  const al2 = (document.getElementById('addonLabel2').value || '').trim();
  const al3 = (document.getElementById('addonLabel3').value || '').trim();
  const av1 = Number(document.getElementById('addonVal1').value)||0;
  const av2 = Number(document.getElementById('addonVal2').value)||0;
  const av3 = Number(document.getElementById('addonVal3').value)||0;
  if(al1) addonLines.push(`  ${al1}: £${fmt(av1)} total`);
  if(al2) addonLines.push(`  ${al2}: £${fmt(av2)} total`);
  if(al3) addonLines.push(`  ${al3}: £${fmt(av3)} total`);
  if(addonLines.length){
    lines.push('Add-ons:');
    lines.push(...addonLines);
    lines.push('');
  }

  lines.push('Notes:');
  lines.push('  - Each selected juice/mocktail adds £1 per guest to the per-head price.');
  lines.push('  - Each selected *special* item adds £2 per guest to the per-head price.');
  lines.push('  - One bread choice is included free per order. If the selected bread is marked *special* its special surcharge still applies.');
  lines.push('  - You may choose up to 2 breads; any additional bread choice beyond the first adds an extra charge per guest.');
  if(b.buffetPerHead > 0) lines.push(`  - Buffet discount of £${fmt(b.buffetPerHead)} per guest applied because service = buffet.`);
  lines.push('');
  lines.push(`Generated: ${new Date().toLocaleString()}`);
  return lines.join('\n');
}

/* ================= PDF PREVIEW + DOWNLOAD ================= */
// build full quote HTML used for preview and PDF rendering
function buildFullQuoteHtml(breakdown) {
  const sel = window.SELECTED_MENU_ITEMS || [];
  const byCat = {};
  sel.forEach(it => {
    if(!byCat[it.category]) byCat[it.category] = [];
    byCat[it.category].push(it);
  });

  const custNameVal = (document.getElementById('custName')?.value || '-');
  const custEmailVal = (document.getElementById('custEmail')?.value || '-');
  const custPhoneVal = (document.getElementById('custPhone')?.value || '-');
  const custDateVal = (document.getElementById('custDate')?.value || '-');
  const custAddressVal = (document.getElementById('custAddress')?.value || '-');

  const al1 = (document.getElementById('addonLabel1')?.value || '').trim();
  const al2 = (document.getElementById('addonLabel2')?.value || '').trim();
  const al3 = (document.getElementById('addonLabel3')?.value || '').trim();
  const av1 = Number(document.getElementById('addonVal1')?.value)||0;
  const av2 = Number(document.getElementById('addonVal2')?.value)||0;
  const av3 = Number(document.getElementById('addonVal3')?.value)||0;

  // --- REPLACE the existing `const style = \`...\`` with this ---
const style = `
  <style>
    :root{
      --accent:#071a3b;   /* deep dark blue */
      --gold:#d4af37;     /* golden/yellowish */
      --bg:#000000;       /* black */
      --muted:#cfc8b0;    /* muted/goldish */
      --card-top: #071a3b;
      --card-bot: #0b0b0b;
    }
    /* Page */
    html,body{height:100%;margin:0;padding:0;background:var(--bg);color:#fff;font-family:Helvetica,Arial,sans-serif}
    .wrap{box-sizing:border-box;padding:22px;width:100%;background:transparent}

    /* Header */
    .header{display:flex;align-items:flex-start;justify-content:space-between;margin-bottom:14px}
    h1{margin:0;font-size:20px;color:var(--gold);letter-spacing:0.2px}
    .small{font-size:10.5px;color:var(--muted);margin-top:4px}

    /* Info column */
    .header .small strong{color:#fff}
    .grid{display:flex;gap:12px;flex-wrap:wrap;margin-bottom:12px}
    .card{flex:1;min-width:220px;background:linear-gradient(180deg,var(--card-top),var(--card-bot));border-radius:8px;padding:10px;border:1px solid rgba(212,175,55,0.08);box-shadow:0 6px 18px rgba(0,0,0,0.6)}
    .card table{width:100%;border-collapse:collapse}
    th{width:45%;text-align:left;font-size:11px;color:var(--muted);padding:6px 8px;border-bottom:1px solid rgba(255,255,255,0.03)}
    td{font-size:11px;color:#fff;padding:6px 8px;border-bottom:1px solid rgba(255,255,255,0.02)}
    .perhead{font-weight:700;color:var(--gold)}

    /* Selected items list */
    h3{margin:8px 0 4px;color:var(--gold);font-size:13px}
    ul{margin:6px 0 0 16px;padding:0;color:#fff;font-size:11px}
    li{margin:3px 0;line-height:1.25}

    /* Addons & totals */
    .totals{margin-top:12px;font-size:12px}
    .total-row{display:flex;justify-content:space-between;padding:6px 0;font-weight:700;color:#fff;border-top:1px dashed rgba(255,255,255,0.03);margin-top:6px}
    .total-row .label{color:var(--muted);font-weight:600}
    .total-row .value{color:var(--gold)}

    /* Notes area */
    .notes{font-size:10px;color:var(--muted);margin-top:10px;line-height:1.25;padding-top:8px;border-top:1px dashed rgba(255,255,255,0.03)}

    /* Make sure long lists are compact to help single-page fit */
    .wrap, table, th, td, ul, li { box-sizing: border-box; }
    table th, table td { padding:4px 6px; font-size:10.5px; }
    ul { margin-left:12px; font-size:10.5px; }

    /* Print friendly - remove shadows for printer clarity */
    @media print {
      .card { box-shadow: none; -webkit-print-color-adjust: exact; print-color-adjust: exact; }
      body { -webkit-print-color-adjust: exact; print-color-adjust: exact; }
    }
  </style>
`;


  const selHtmlParts = [];
  const catOrder = ['canapes','starters','mains_nonveg','mains_veg','rice','desserts','breads','juices','drinks','selector','breakfast'];
  catOrder.forEach(cat => {
    if(byCat[cat] && byCat[cat].length){
      selHtmlParts.push(`<div><strong>${cat.replace(/_/g,' ')}</strong><ul>`);
      byCat[cat].forEach(it => selHtmlParts.push(`<li>${it.name}${it.special? ' *special*' : ''}</li>`));
      selHtmlParts.push(`</ul></div>`);
    }
  });
  Object.keys(byCat).forEach(cat => {
    if(!catOrder.includes(cat)){
      selHtmlParts.push(`<div><strong>${cat}</strong><ul>`);
      byCat[cat].forEach(it => selHtmlParts.push(`<li>${it.name}${it.special? ' *special*' : ''}</li>`));
      selHtmlParts.push(`</ul></div>`);
    }
  });

  const selectedHtml = selHtmlParts.length ? selHtmlParts.join('') : '<div><em>No items selected</em></div>';
  const addonLines = [];
  if(al1) addonLines.push(`${al1}: £${fmt(av1)}`);
  if(al2) addonLines.push(`${al2}: £${fmt(av2)}`);
  if(al3) addonLines.push(`${al3}: £${fmt(av3)}`);

  const html = `
    <!doctype html><html><head><meta charset="utf-8">${style}</head><body>
    <div class="wrap" id="quote-pdf">
      <div class="header">
        <div>
          <h1>Dawat — Catering Quote</h1>
          <div class="small">Generated: ${new Date().toLocaleString()}</div>
        </div>
        <div style="text-align:right">
          <div class="small">Customer: ${custNameVal}</div>
          <div class="small">${custEmailVal} ${custPhoneVal ? '· ' + custPhoneVal : ''}</div>
          <div class="small">Date: ${custDateVal}</div>
          <div class="small">Venue: ${custAddressVal}</div>
        </div>
      </div>

      <div class="grid">
        <div class="card">
          <table>
            <tr><th>Guests</th><td>${breakdown.guests}</td></tr>
            <tr><th>Service</th><td>${breakdown.service}</td></tr>
            <tr><th>Package</th><td>${breakdown.pkg}</td></tr>
            <tr><th>Per head</th><td>£${fmt(breakdown.perHead)}</td></tr>
            <tr><th>Drink surcharge (total)</th><td>£${fmt(breakdown.drinksTotal)}</td></tr>
            <tr><th>Buffet discount</th><td>£${fmt(breakdown.buffetTotal)}</td></tr>
            <tr><th>Add-ons (total)</th><td>£${fmt(breakdown.addonsTotal)}</td></tr>
            <tr><th>Adjustments & specials</th><td>£${fmt((breakdown.adjustmentsPerHead + breakdown.specialPerHead)*breakdown.guests)}</td></tr>
            <tr><th>Discount</th><td>${breakdown.discountPct}%</td></tr>
          </table>
        </div>
      </div>

      <div style="margin-top:8px">
        <h3 style="margin:6px 0 4px">Selected Menu Items</h3>
        ${selectedHtml}
      </div>

      ${ addonLines.length ? `<div style="margin-top:8px"><strong>Add-ons</strong><ul>${addonLines.map(a=>`<li>${a}</li>`).join('')}</ul></div>` : ''}

      <div class="totals">
        <div class="total-row"><div>Subtotal</div><div>£${fmt(breakdown.preDiscountGrand)}</div></div>
        <div class="total-row"><div>Discount (-${breakdown.discountPct}%)</div><div>-£${fmt(breakdown.discountAmount)}</div></div>
        <div class="total-row"><div>Grand total</div><div>£${fmt(breakdown.grandTotal)}</div></div>
      </div>

      <div class="notes">
        ${ breakdown.service === 'buffet' ? 
          `<strong>Buffet service note:</strong> For buffet service, we provide self-serve stations and set-up.` :
          `<strong>Table service note:</strong> We will provide complete Event Management inclusive of onsite Event Managers, Waiters For Service, Kitchen Chefs and Crew. We will provide the Crockery, Cutlery, Glassware, Table Linens and Napkins. Our designated staff will be able to serve and service your Event respectively throughout the day to the highest of standards. This includes setting up, winding down and ensuring complete execution of the Event meticulously whereby we take care of everything from Start to Finish.`
        }
      </div>
    </div>
    </body></html>
  `;
  return html;
}

// render pdf preview inside iframe in the preview panel
function renderPdfPreview(){
  const breakdown = computeQuote();
  const html = buildFullQuoteHtml(breakdown);
  pdfPreviewEl.innerHTML = ''; // clear
  const iframe = document.createElement('iframe');
  iframe.style.width = '100%';
  iframe.style.height = '1122px'; // A4-ish preview
  iframe.style.border = 'none';
  iframe.srcdoc = html;
  pdfPreviewEl.appendChild(iframe);
}

// ----------------- REPLACE downloadPdfSinglePage WITH THIS -----------------
async function downloadPdfSinglePage(){
  // ensure latest numbers
  const breakdown = computeQuote();
  const html = buildFullQuoteHtml(breakdown);

  // create off-screen wrapper
  const wrapper = document.createElement('div');
  wrapper.style.position = 'fixed';
  wrapper.style.left = '-20000px';
  wrapper.style.top = '0';
  wrapper.style.background = '#fff';
  wrapper.id = 'pdf-temp-wrapper';
  wrapper.innerHTML = html;
  document.body.appendChild(wrapper);

  try {
    // create jsPDF to read A4 size in points
    const { jsPDF } = window.jspdf || {};
    const PDFConstructor = (window.jspdf && window.jspdf.jsPDF) ? window.jspdf.jsPDF : (jsPDF ? jsPDF : null);
    if(!PDFConstructor) throw new Error('jsPDF not found');

    const pdf = new PDFConstructor({ unit: 'pt', format: 'a4' });
    const pdfW = 595 ;   // width in points (~595)
    const pdfH = 842 ;   // height in points (~842)
    const marginPts = 14; // small margin in points

    // conversion: points -> CSS pixels (assuming 96dpi): px = pt * 96/72
    const pxPerPt = 96 / 72;

    // choose a renderScale (higher -> sharper, but more memory). Use devicePixelRatio as baseline.
    const baseDPR = window.devicePixelRatio || 1;
    const renderScale = Math.max(2, Math.min(4, baseDPR * 2)); // 2..4 recommended

    // set wrapper width in CSS pixels so the rendered canvas maps nicely to A4 proportions
    // target CSS width = pdf width (pts) * pxPerPt * renderScale
    const wrapperWidthPx = Math.round(pdfW * pxPerPt * renderScale);
    wrapper.style.width = '794px';   // A4 width @ 96dpi
    wrapper.style.minHeight = '1123px'; // A4 height @ 96dpi

    // give the browser a tick so layout settles (helps in some environments)
    await new Promise(r => requestAnimationFrame(r));

  wrapper.style.background = '#000';
  const innerBody = wrapper.querySelector('body');
  if(innerBody) innerBody.style.background = '#000';

    // render with html2canvas at the chosen scale
   const canvas = await html2canvas(wrapper, {
   scale: renderScale,
    useCORS: true,
    logging: false,
  backgroundColor: '#000'
});
    const imgData = canvas.toDataURL('image/png');

    // Compute target image size in PDF points that will *fit* inside A4 minus margins
    const targetW_pts = pdfW - marginPts * 2; // available width in points
    // compute image height (points) preserving aspect ratio
    let targetH_pts = (canvas.height * targetW_pts) / canvas.width;

    // If image height is taller than the page available height, scale down to fit
    const availableH_pts = pdfH - marginPts * 2;
    let finalW_pts = targetW_pts;
    let finalH_pts = targetH_pts;
    if(finalH_pts > availableH_pts){
      const scaleDown = availableH_pts / finalH_pts;
      finalH_pts = finalH_pts * scaleDown;
      finalW_pts = finalW_pts * scaleDown;
    }

    // center on page
    const x = (pdfW - finalW_pts) / 2;
    const y = (pdfH - finalH_pts) / 2;

    // add image (dimensions are in points because pdf unit = 'pt')
    // FORCE image to fill entire A4 page (no centering, no scaling logic)
 pdf.addImage(
  imgData,
  'PNG',
  0,
  0,
  pdf.internal.pageSize.getWidth(),
  pdf.internal.pageSize.getHeight()
);
    // save
    pdf.save('Dawat-Quote.pdf');

  } catch (err) {
    console.error('Single-page PDF generation failed', err);
    alert('PDF generation failed — opening printable preview instead.');
    const w = window.open('', '_blank', 'noopener');
    if(w){
      w.document.write(html);
      w.document.close();
    }
  } finally {
    const el = document.getElementById('pdf-temp-wrapper');
    if(el) el.remove();
  }
}
/* Wire download & open preview buttons */
document.getElementById('downloadPdfBtn').addEventListener('click', downloadPdfSinglePage);
document.getElementById('openPdfInNewTab').addEventListener('click', () => {
  const b = computeQuote();
  const html = buildFullQuoteHtml(b);
  const w = window.open('', '_blank', 'noopener');
  if(!w){ alert('Unable to open new tab — browser blocked popups.'); return; }
  w.document.write(html);
  w.document.close();
});
/* ================= RESET BTN (updated) ================= */
function setActiveCategoryButton(cat = 'all'){
  const btns = document.querySelectorAll('.menu-panel button[data-cat]');
  btns.forEach(b => b.classList.toggle('active', b.dataset.cat === cat));
}
document.getElementById('resetBtn').addEventListener('click', () => {
  // customer
  custName.value = '';
  custEmail.value = '';
  custPhone.value = '';
  custAddress.value = '';
  custDate.value = '';

  // guests & service
  guestsEl.value = 120;
  document.querySelector('input[name="service"][value="table"]').checked = true;

  // package grid & lock
  packageSelect.value = 'Bronze';
  lockPackage.checked = true;
  applyPackageDefaults('Bronze');
  updateLock();
  renderPackagesGrid();

  // per-category inputs
  nCanapes.value = PACKAGE_DEFAULTS['Bronze'].canapes;
  nStarters.value = PACKAGE_DEFAULTS['Bronze'].starters;
  nMains.value = PACKAGE_DEFAULTS['Bronze'].mains;
  nDesserts.value = PACKAGE_DEFAULTS['Bronze'].desserts;
  [nCanapes,nStarters,nMains,nDesserts].forEach(inp => inp.dispatchEvent(new Event('change', { bubbles: true })));

  // menu selections (including breads)
  window.SELECTED_MENU_ITEMS = [];
  selCountEl.textContent = '0';
  populateMenuItems('all');
  setActiveCategoryButton('all');

  // addons & discount
  document.getElementById('addonLabel1').value = '';
  document.getElementById('addonLabel2').value = '';
  document.getElementById('addonLabel3').value = '';
  document.getElementById('addonVal1').value = '';
  document.getElementById('addonVal2').value = '';
  document.getElementById('addonVal3').value = '';
  discountPctEl.value = 0;

  computeQuote();
});

/* ================= INIT ================= */
packageSelect.value = 'Bronze';
renderPackagesGrid();
applyPackageDefaults("Bronze");
updateLock();
populateMenuItems('all');
setActiveCategoryButton('all');
computeQuote();

// Recompute on service change
document.querySelectorAll('input[name="service"]').forEach(r => r.addEventListener('change', computeQuote));
</script>
</body>
</html>
   
